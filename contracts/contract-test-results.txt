

  ACECompliance
    KYC Verification
      ✔ Should verify KYC for a user
      ✔ Should reject KYC verification from unauthorized caller
      ✔ Should return correct KYC status
    Jurisdictional Policies
      ✔ Should allow transaction when policy permits
      ✔ Should block transaction when jurisdiction is blocked
      ✔ Should use default vertical policy as fallback
    Reputation System
      ✔ Should initialize reputation at 50%
      ✔ Should update reputation correctly
      ✔ Should cap reputation at 0 and 10000
    Blacklisting
      ✔ Should blacklist user
      ✔ Should unblacklist user (owner only)
    Full Compliance Check
      ✔ Should pass full compliance for valid users
      ✔ Should fail compliance if seller is blacklisted
      ✔ Should fail compliance if KYC not valid

  Integration Tests
    Full Lead Lifecycle
      1) Should complete full flow: mint → list → bid → resolve → transfer
      2) Should handle multiple bidders correctly
    Compliance Integration
      ✔ Should block transaction if buyer fails compliance
    Edge Cases
      ✔ Should handle expired lead gracefully

  LeadNFTv2
    Deployment
      ✔ Should set correct name and symbol
      ✔ Should set owner correctly
    Minting
      ✔ Should mint a lead NFT with correct metadata
      ✔ Should revert if lead already tokenized
      ✔ Should revert if caller is not authorized
      ✔ Should revert if expiry is in the past
    Lead Metadata
      ✔ Should return correct lead metadata
      ✔ Should get lead by platform ID
      ✔ Should check lead validity correctly
    Sale Recording
      ✔ Should record sale correctly
    Verification
      ✔ Should verify lead
    Different Lead Sources
      ✔ Should mint leads from different sources

  Marketplace
    Listing Creation
      ✔ Should create a listing successfully
      ✔ Should revert if not token owner
    Commit-Reveal Bidding
      ✔ Should commit a bid
      3) Should reveal a bid correctly
      ✔ Should reject invalid reveal
      4) Should resolve auction with highest bidder winning
    Buyer Preference Filters
      ✔ Should reject bid if buyer has offsite toggle disabled
      ✔ Should reject bid if geo is blocked
      ✔ Should allow bid if buyer accepts all
    Buy Now
      ✔ Should execute buy now correctly
    Edge Cases
      ✔ Should handle no valid bids in auction
      5) Should reject bids below reserve price on reveal


  37 passing (1s)
  5 failing

  1) Integration Tests
       Full Lead Lifecycle
         Should complete full flow: mint → list → bid → resolve → transfer:
     Error: VM Exception while processing transaction: reverted with reason string 'Marketplace: Invalid reveal'
    at Marketplace.revealBid (contracts/Marketplace.sol:243)
    at EdrProviderWrapper.request (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\hardhat\src\internal\hardhat-network\provider\provider.ts:453:41)
    at async HardhatEthersSigner.sendTransaction (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\@nomicfoundation\hardhat-ethers\src\signers.ts:185:18)
    at async send (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\ethers\src.ts\contract\contract.ts:313:20)
    at async Proxy.revealBid (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\ethers\src.ts\contract\contract.ts:352:16)
    at async Context.<anonymous> (test\Integration.test.ts:115:13)
  

  2) Integration Tests
       Full Lead Lifecycle
         Should handle multiple bidders correctly:
     Error: VM Exception while processing transaction: reverted with reason string 'Marketplace: Invalid reveal'
    at Marketplace.revealBid (contracts/Marketplace.sol:243)
    at EdrProviderWrapper.request (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\hardhat\src\internal\hardhat-network\provider\provider.ts:453:41)
    at async HardhatEthersSigner.sendTransaction (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\@nomicfoundation\hardhat-ethers\src\signers.ts:185:18)
    at async send (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\ethers\src.ts\contract\contract.ts:313:20)
    at async Proxy.revealBid (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\ethers\src.ts\contract\contract.ts:352:16)
    at async Context.<anonymous> (test\Integration.test.ts:157:13)
  

  3) Marketplace
       Commit-Reveal Bidding
         Should reveal a bid correctly:
     Error: VM Exception while processing transaction: reverted with reason string 'Marketplace: Invalid reveal'
    at Marketplace.revealBid (contracts/Marketplace.sol:243)
    at EdrProviderWrapper.request (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\hardhat\src\internal\hardhat-network\provider\provider.ts:453:41)
    at async HardhatEthersSigner.sendTransaction (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\@nomicfoundation\hardhat-ethers\src\signers.ts:185:18)
    at async send (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\ethers\src.ts\contract\contract.ts:313:20)
    at async Proxy.revealBid (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\ethers\src.ts\contract\contract.ts:352:16)
    at async waitForPendingTransaction (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\@nomicfoundation\hardhat-chai-matchers\src\internal\emit.ts:28:17)
    at async Context.<anonymous> (test\Marketplace.test.ts:190:13)
  

  4) Marketplace
       Commit-Reveal Bidding
         Should resolve auction with highest bidder winning:
     Error: VM Exception while processing transaction: reverted with reason string 'Marketplace: Invalid reveal'
    at Marketplace.revealBid (contracts/Marketplace.sol:243)
    at EdrProviderWrapper.request (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\hardhat\src\internal\hardhat-network\provider\provider.ts:453:41)
    at async HardhatEthersSigner.sendTransaction (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\@nomicfoundation\hardhat-ethers\src\signers.ts:185:18)
    at async send (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\ethers\src.ts\contract\contract.ts:313:20)
    at async Proxy.revealBid (C:\Users\Bruce\Projects\Lead Engine CRE\node_modules\ethers\src.ts\contract\contract.ts:352:16)
    at async Context.<anonymous> (test\Marketplace.test.ts:235:13)
  

  5) Marketplace
       Edge Cases
         Should reject bids below reserve price on reveal:
     AssertionError: Expected transaction to be reverted with reason 'Marketplace: Below reserve', but it reverted with reason 'Marketplace: Invalid reveal'
      at async Context.<anonymous> (test\Marketplace.test.ts:406:13)



