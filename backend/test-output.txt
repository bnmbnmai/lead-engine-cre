  console.log
    [NOTIFICATION] Digest flushed: 0 users, 0 total

      at flushNotificationDigest (src/services/notification.service.ts:220:13)

  console.log
    [NOTIFICATION] Digest flushed: 1 users, 1 total

      at flushNotificationDigest (src/services/notification.service.ts:220:13)

  console.log
    [NOTIFICATION] Digest flushed: 0 users, 0 total

      at flushNotificationDigest (src/services/notification.service.ts:220:13)

  console.log
    [NOTIFICATION] Digest flushed: 2 users, 3 total

      at flushNotificationDigest (src/services/notification.service.ts:220:13)

  console.log
    [NOTIFICATION] Digest flushed: 0 users, 0 total

      at flushNotificationDigest (src/services/notification.service.ts:220:13)

  console.log
    [NOTIFICATION] Digest flushed: 1 users, 1 total

      at flushNotificationDigest (src/services/notification.service.ts:220:13)

  console.log
    [NOTIFICATION] Digest flushed: 0 users, 0 total

      at flushNotificationDigest (src/services/notification.service.ts:220:13)

  console.log
    [NOTIFICATION] Digest flushed: 0 users, 0 total

      at flushNotificationDigest (src/services/notification.service.ts:220:13)

  console.log
    [NOTIFICATION] Digest flushed: 0 users, 0 total

      at flushNotificationDigest (src/services/notification.service.ts:220:13)

node.exe : FAIL tests/unit/p2-fixes.test.ts
At C:\Program Files\nodejs\npx.ps1:29 char:3
+   & $NODE_EXE $NPX_CLI_JS $args
+   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (FAIL tests/uni 
   t/p2-fixes.test.ts:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
  #3 Rate Limit Alignment
    ΓêÜ rtbBiddingLimiter config uses 60s window (15 ms)
    ΓêÜ exported limiters all exist
    ΓêÜ createTieredLimiter returns a middleware function 
(1 ms)
  #5 Trademark Blocklist
    ΓêÜ blocklist contains major brands (1 ms)
    ΓêÜ blocklist has ~200 entries
    ΓêÜ allowed non-brand name passes
    ΓêÜ case insensitive check works (1 ms)
  Jaccard Similarity
    ΓêÜ identical strings ΓåÆ 1.0
    ΓêÜ completely different ΓåÆ near 0
    ΓêÜ partial overlap ΓåÆ moderate score (1 ms)
    ├ù isDuplicateSuggestion flags close matches (2 ms)
  #14 PII Unicode Scrubbing
    ΓêÜ scrubs standard email (2 ms)
    ΓêÜ scrubs US phone number (2 ms)
    ΓêÜ scrubs CJK names (Chinese) (2 ms)
    ΓêÜ scrubs Devanagari names (Hindi)
    ΓêÜ scrubs Latin title+name (1 ms)
  #8 Cache Invalidation
    ΓêÜ invalidateNftOwnership deletes cache key (1 ms)
    ΓêÜ invalidation called on settle
    ΓêÜ cache miss after invalidation forces fresh lookup
  Notification Batching
    ΓêÜ queues notification when GDPR consent given (10 ms)
    ΓêÜ rejects notification without GDPR consent (1 ms)
    ΓêÜ flush returns digest grouped by user (2 ms)
    ΓêÜ flush clears queue (1 ms)
    ΓêÜ NOTIFICATION_CONSTANTS exported correctly (1 ms)
    ΓêÜ hasGdprConsent returns boolean (2 ms)
  Coordinated Spam Edge Cases
    ├ù 5+ distinct suggestions with same slug pattern 
detected by Jaccard (1 ms)
    ΓêÜ legitimate different verticals pass dedup
  P2 Fix Test Count
    ΓêÜ minimum 27 tests in this file (3 ms)

  ΓùÅ Jaccard Similarity ΓÇ║ isDuplicateSuggestion flags 
close matches

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 160 |[39m     
test([32m'isDuplicateSuggestion flags close 
matches'[39m[33m,[39m () [33m=>[39m {
     [90m 161 |[39m         [36mconst[39m existing 
[33m=[39m [[32m'solar-panel-install'[39m[33m,[39m 
[32m'residential-roofing'[39m][33m;[39m
    [31m[1m>[22m[39m[90m 162 |[39m         expect(isDu
plicateSuggestion([32m'solar-panel-installation'[39m[33m,
[39m existing))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                       
                                      [31m[1m^[22m[39m
     [90m 163 |[39m         expect(isDuplicateSuggestion(
[32m'commercial-hvac-maintenance'[39m[33m,[39m 
existing))[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 164 |[39m     })[33m;[39m
     [90m 165 |[39m })[33m;[39m[0m

      at Object.<anonymous> 
(tests/unit/p2-fixes.test.ts:162:77)

  ΓùÅ Coordinated Spam Edge Cases ΓÇ║ 5+ distinct 
suggestions with same slug pattern detected by Jaccard

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 308 |[39m         [90m// A new coordinated 
attempt[39m
     [90m 309 |[39m         [36mconst[39m isDup 
[33m=[39m isDuplicateSuggestion([32m'solar-panel-installi
ng'[39m[33m,[39m existingSlugs)[33m;[39m
    [31m[1m>[22m[39m[90m 310 |[39m         
expect(isDup)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                       
[31m[1m^[22m[39m
     [90m 311 |[39m     })[33m;[39m
     [90m 312 |[39m
     [90m 313 |[39m     test([32m'legitimate different 
verticals pass dedup'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> 
(tests/unit/p2-fixes.test.ts:310:23)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 26 passed, 28 total
Snapshots:   0 total
Time:        1.103 s
Ran all test suites matching 
/tests\\unit\\p2-fixes.test.ts/i.
